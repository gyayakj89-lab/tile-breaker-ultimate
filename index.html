<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tile Breaker Clean</title>

<style>
body{
    margin:0;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    overflow:hidden;
    font-family:Arial;
    background: radial-gradient(circle at 20% 20%, #1a1a2e, #0f0f1a 50%, #000 100%);
}
canvas{
    background: radial-gradient(circle,#111,#000);
    border-radius:20px;
    box-shadow:0 0 40px cyan;
}
#menu{
    position:absolute;
    text-align:center;
    color:cyan;
}
button{
    padding:8px 16px;
    margin:6px;
    border:none;
    border-radius:8px;
    background:linear-gradient(45deg,cyan,blue);
    font-weight:bold;
    cursor:pointer;
}
#ui{
    position:absolute;
    top:10px;
    color:white;
    font-size:14px;
}
</style>
</head>
<body>

<div id="menu">
    <h2>Select Difficulty</h2>
    <button onclick="startGame('easy')">Easy</button>
    <button onclick="startGame('medium')">Medium</button>
    <button onclick="startGame('hard')">Hard</button>
</div>

<div id="ui">
Score: <span id="score">0</span> |
Lives: <span id="lives">3</span> |
Level: <span id="level">1</span> |
High: <span id="high">0</span>
</div>

<canvas id="game" width="900" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let paddle, balls, bricks, powerUps;
let rows, cols = 12;
let score=0, lives=3, level=1;
let highScore=localStorage.getItem("tbHigh")||0;
let ballSpeed=4;
let running=false;

document.getElementById("high").innerText=highScore;

function startGame(mode){
    document.getElementById("menu").style.display="none";
    running=true;

    if(mode==="easy"){rows=4; ballSpeed=3;}
    if(mode==="medium"){rows=6; ballSpeed=4;}
    if(mode==="hard"){rows=8; ballSpeed=5;}

    score=0; lives=3; level=1;
    init();
}

function init(){
    paddle={x:canvas.width/2-60,y:canvas.height-40,w:120,h:18};
    balls=[createBall()];
    powerUps=[];
    generateBricks();
}

function createBall(){
    return {
        x:canvas.width/2,
        y:canvas.height-60,
        r:8,
        dx:ballSpeed*(Math.random()<0.5?1:-1),
        dy:-ballSpeed
    };
}

function generateBricks(){
    bricks=[];
    let bw=60, bh=20, pad=10;
    let offsetX=(canvas.width-(cols*(bw+pad)))/2;

    for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
            bricks.push({
                x:offsetX+c*(bw+pad),
                y:50+r*(bh+pad),
                w:bw,
                h:bh,
                alive:true
            });
        }
    }
}

document.addEventListener("mousemove",e=>{
    const rect=canvas.getBoundingClientRect();
    paddle.x=e.clientX-rect.left-paddle.w/2;
    clampPaddle();
});

canvas.addEventListener("touchmove",e=>{
    const rect=canvas.getBoundingClientRect();
    paddle.x=e.touches[0].clientX-rect.left-paddle.w/2;
    clampPaddle();
});

function clampPaddle(){
    if(paddle.x<0)paddle.x=0;
    if(paddle.x+paddle.w>canvas.width)
        paddle.x=canvas.width-paddle.w;
}

function spawnPower(x,y){
    if(Math.random()<0.3){
        const types=["expand","multi","slow"];
        powerUps.push({
            x,y,
            type:types[Math.floor(Math.random()*3)],
            dy:2
        });
    }
}

function applyPower(type){
    if(type==="expand"){
        paddle.w+=40;
        setTimeout(()=>{paddle.w-=40;},6000);
    }
    if(type==="multi"){
        balls.push(createBall());
    }
    if(type==="slow"){
        balls.forEach(b=>{b.dx*=0.6;b.dy*=0.6;});
        setTimeout(()=>{balls.forEach(b=>{b.dx/=0.6;b.dy/=0.6;});},5000);
    }
}

function update(){

    balls.forEach(ball=>{
        ball.x+=ball.dx;
        ball.y+=ball.dy;

        if(ball.x-ball.r<0||ball.x+ball.r>canvas.width) ball.dx*=-1;
        if(ball.y-ball.r<0) ball.dy*=-1;

        if(ball.x>paddle.x && ball.x<paddle.x+paddle.w &&
           ball.y+ball.r>paddle.y){
            ball.dy=-Math.abs(ball.dy);
        }

        bricks.forEach(b=>{
            if(b.alive){
                if(ball.x>b.x && ball.x<b.x+b.w &&
                   ball.y>b.y && ball.y<b.y+b.h){
                    ball.dy*=-1;
                    b.alive=false;
                    score+=10;
                    spawnPower(b.x+b.w/2,b.y);
                }
            }
        });
    });

    // Remove fallen balls
    balls = balls.filter(ball => ball.y - ball.r <= canvas.height);

    // If ALL balls gone â†’ lose 1 life
    if(balls.length===0){
        lives--;

        if(lives<=0){
            running=false;
            alert("Game Over! Final Score: "+score);
            document.getElementById("menu").style.display="block";
            return;
        }

        balls.push(createBall());
    }

    bricks=bricks.filter(b=>b.alive);

    if(bricks.length===0){
        level++;
        rows++;
        generateBricks();
    }

    powerUps.forEach(p=>{
        p.y+=p.dy;
        if(p.y>paddle.y && p.x>paddle.x && p.x<paddle.x+paddle.w){
            applyPower(p.type);
            p.y=9999;
        }
    });
    powerUps=powerUps.filter(p=>p.y<canvas.height);

    if(score>highScore){
        highScore=score;
        localStorage.setItem("tbHigh",highScore);
    }

    document.getElementById("score").innerText=score;
    document.getElementById("lives").innerText=lives;
    document.getElementById("level").innerText=level;
    document.getElementById("high").innerText=highScore;
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    bricks.forEach(b=>{
        ctx.fillStyle="cyan";
        ctx.fillRect(b.x,b.y,b.w,b.h);
    });

    powerUps.forEach(p=>{
        ctx.fillStyle="orange";
        ctx.fillRect(p.x-6,p.y-6,12,12);
    });

    ctx.fillStyle="lime";
    ctx.beginPath();
    ctx.roundRect(paddle.x,paddle.y,paddle.w,paddle.h,12);
    ctx.fill();

    balls.forEach(ball=>{
        ctx.beginPath();
        ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);
        ctx.fillStyle="white";
        ctx.fill();
    });
}

function loop(){
    if(running){
        update();
        draw();
    }
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
